!function(G,S,I){"use strict";function $(f,Z){this.position=f,this.$22n=Z}var W="ht",M=G[W],v=null,P=Math,R=P.PI,K=P.cos,n=P.sin,J=P.abs,X=P.max,t=P.sqrt,L=1e-5,Z=M.Default,l=Z.def,z=Z.startAnim,r=Z.createMatrix,V=Z.transformVec,F=Z.getInternal(),w=F.addMethod,q=F.superCall,N=F.toPointsArray,_=F.createNormals,C=F.toFloatArray,E=F.glMV,H=(F.glPop,M.graph3d.Graph3dView,M.Math),j=H.Vector3,T=H.Matrix4,B=H.Euler,y=(H.Quaternion,F.batchShape),s=F.createNodeMatrix,O=F.getFaceInfo,k=F.transformAppend,U=F.drawFaceInfo,c=F.createAnim,Q=F.cube(),x=Q.is,A=Q.vs,f=Q.uv,D=F.ui(),u=M.Node,i=M.Shape,a="h",d="v",b="front",p="back",o="left",h="right",m="top",Y="bottom",g="dw.expanded",e=".expanded",Dd="dw.angle",hr=".angle",dj=function(s,j,d){l(W+"."+s,j,d)},Bp=function(V,J,W){W?V.push(J.x,J.y):V.push(J.x,J.y,J.z)},Rc=function(){var J=new M.Math.Vector3,j=new M.Math.Vector3,g=new M.Math.Vector3;return function(H,x,z,Z,w){if(J.copy(x.$24n),j.copy(z.$24n),g.copy(Z.$24n),!(g.equals(J)||j.equals(J)||j.equals(g))){if(!x.$22n||!z.$22n||!Z.$22n){var W=j.sub(J).cross(g.sub(J)).normalize().multiplyScalar(1).toArray();x.$22n||(x.$22n=new ol(W)),z.$22n||(z.$22n=new ol(W)),Z.$22n||(Z.$22n=new ol(W))}H.push(new dk([x,z,Z],w))}}}(),Ag=function(O,h,M,H){var n,S,m,X,W=0,j=[];if(H)for(n=H.length;n>W;W+=3)S=H[W],m=H[W+1],X=H[W+2],Rc(j,new rn([h[3*S],h[3*S+1],h[3*S+2]],null,M?[M[2*S],M[2*S+1],0]:v),new rn([h[3*m],h[3*m+1],h[3*m+2]],null,M?[M[2*m],M[2*m+1],0]:v),new rn([h[3*X],h[3*X+1],h[3*X+2]],null,M?[M[2*X],M[2*X+1],0]:v),O);else for(n=h.length/3;n>W;W+=3)S=W,m=W+1,X=W+2,Rc(j,new rn([h[3*S],h[3*S+1],h[3*S+2]],null,M?[M[2*S],M[2*S+1],0]:v),new rn([h[3*m],h[3*m+1],h[3*m+2]],null,M?[M[2*m],M[2*m+1],0]:v),new rn([h[3*X],h[3*X+1],h[3*X+2]],null,M?[M[2*X],M[2*X+1],0]:v),O);return j},Fc=[o,b,h,p,m,Y],Gp=["",m,Y],sq=Fc.concat("csg"),Vg=[0,6,12,18,24,30],jn=function(w,E,M){var X=s(w),t=[];w.appendAnchorMatrix3d(X);var Y,$=E?E.getData3dUI(w):null;if($&&$.s("shape3d")&&!$.s("csg.cull.box")&&(Y=$.shapeModel,$.shapeModel||(Y=F.getShapeModel($,$.s("shape3d"))),Y))for(var K=F.createNormalMatrix(X),m=0,Q=Gp.length;Q>m;m++){var W=Gp[m],O=W.length?W+"_":W,I=Y[O+"vs"],H=Y[O+"uv"],P=Y[O+"is"],u=Y[O+"ns"];if(I&&I.length)for(var l,h,q,S=0,T=P?P.length:I.length/3;T>S;S+=3)P?(l=P[S],h=P[S+1],q=P[S+2]):(l=S,h=S+1,q=S+2),Rc(t,new rn(V([I[3*l],I[3*l+1],I[3*l+2]],X),u?V([u[3*l],u[3*l+1],u[3*l+2]],K):null,[H[2*l],H[2*l+1],0]),new rn(V([I[3*h],I[3*h+1],I[3*h+2]],X),u?V([u[3*h],u[3*h+1],u[3*h+2]],K):null,[H[2*h],H[2*h+1],0]),new rn(V([I[3*q],I[3*q+1],I[3*q+2]],X),u?V([u[3*q],u[3*q+1],u[3*q+2]],K):null,[H[2*q],H[2*q+1],0]),w)}if(!Y)for(var m=0;6>m;m++)for(var W=Fc[m],Z=Vg[m],H=M?E.getFaceUv(w,W):v,_=M?E.getFaceUvScale(w,W):v,g=M?E.getFaceUvOffset(w,W):v,b=0;2>b;b++){var U,k,G,C=x[Z+3*b],e=x[Z+3*b+1],n=x[Z+3*b+2];if(M){if(H){var d=8*m;U=[H[2*C-d],H[2*C+1-d],0],k=[H[2*e-d],H[2*e+1-d],0],G=[H[2*n-d],H[2*n+1-d],0]}else U=[f[2*C],f[2*C+1],0],k=[f[2*e],f[2*e+1],0],G=[f[2*n],f[2*n+1],0];_&&(U[0]*=_[0],U[1]*=_[1],k[0]*=_[0],k[1]*=_[1],G[0]*=_[0],G[1]*=_[1]),g&&(U[0]+=g[0],U[1]+=g[1],k[0]+=g[0],k[1]+=g[1],G[0]+=g[0],G[1]+=g[1])}Rc(t,new rn(V([A[3*C],A[3*C+1],A[3*C+2]],X),null,U),new rn(V([A[3*e],A[3*e+1],A[3*e+2]],X),null,k),new rn(V([A[3*n],A[3*n+1],A[3*n+2]],X),null,G),w)}return xf.$15n(t)},Wo=function(P,Y){var x,L=P.data.getAttaches();if(L&&L.each(function(U){U instanceof rb&&U.s("attach.operation")&&(x||(x=[]),x.push(U))}),x){var b;Fc.forEach(function(r){var u=Ag(r,P[r].vs,P[r].tuv);b=b?b.concat(u):u}),b=xf.$15n(b),x.forEach(function(N){var O=N.s("attach.operation");b[O]&&(b=b[O](jn(N,P.gv,P.csg.tuv)))}),Fc.forEach(function(F){F=P[F],F.vs=[],F.ns=[],F.tuv&&(F.tuv=[])}),P.csg&&!P.csg.ns&&(P.csg.ns=[]);var k=[];if(b.$19n().forEach(function(o){var Q,R=o.$10n;if(R instanceof rb){if(R.s("attach.cull"))return;Q=R.s("csg.cull.color"),Q&&(Q=F.toColorArray(Q)),R="csg"}for(var H=P[R],g=H.vs,t=H.ns,c=H.tuv,V=o.$9n,$=2;$<V.length;$++)if(Bp(g,V[0].$24n),Bp(g,V[$-1].$24n),Bp(g,V[$].$24n),t&&(Bp(t,V[0].$22n),Bp(t,V[$-1].$22n),Bp(t,V[$].$22n)),c&&(Bp(c,V[0].uv,!0),Bp(c,V[$-1].uv,!0),Bp(c,V[$].uv,!0)),Q)for(var n=4*(g.length/3),j=0;3>j;j++)k[--n]=Q[3],k[--n]=Q[2],k[--n]=Q[1],k[--n]=Q[0]}),k.length){for(var M=F.toColorArray(P.csg.color),i=0,G=4*(P.csg.vs.length/3);G>i;i+=4)k[i]==I&&(k[i]=M[0],k[i+1]=M[1],k[i+2]=M[2],k[i+3]=M[3]);P.csg.cs=k}}sq.forEach(function(H){var G=P[H];G.visible&&G.vs.length?(G.ns&&G.ns.length?C(G,"ns"):G.ns=_(G.vs),C(G,"vs"),C(G,"tuv"),G.cs&&C(G,"cs")):delete P[H]}),Y&&(y(P,v,Y),P.clear())};w(Z,{createFrameModel:function(g,e,f,J){g=g==v?.07:g,e=e==v?g:e,f=f==v?g:f,J=J?J:{};var c=J.top,G=J.bottom,t=J.left,p=J.right,M=J.front,S=J.back,B=[],n=[];return M===!0?(B.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),n.push(0,0,0,1,1,1,1,1,1,0,0,0)):M===!1||(B.push(-.5,.5,.5,-.5,-.5,.5,-.5+g,-.5,.5,-.5+g,-.5,.5,-.5+g,.5,.5,-.5,.5,.5,.5-g,.5,.5,.5-g,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-g,.5,.5,-.5+g,.5,.5,-.5+g,.5-e,.5,.5-g,.5-e,.5,.5-g,.5-e,.5,.5-g,.5,.5,-.5+g,.5,.5,-.5+g,-.5+e,.5,-.5+g,-.5,.5,.5-g,-.5,.5,.5-g,-.5,.5,.5-g,-.5+e,.5,-.5+g,-.5+e,.5),n.push(0,0,0,1,g,1,g,1,g,0,0,0,1-g,0,1-g,1,1,1,1,1,1,0,1-g,0,g,0,g,e,1-g,e,1-g,e,1-g,0,g,0,g,1-e,g,1,1-g,1,1-g,1,1-g,1-e,g,1-e)),S===!0?(B.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),n.push(1,0,0,1,1,1,0,1,1,0,0,0)):S===!1||(B.push(-.5,.5,-.5,-.5+g,-.5,-.5,-.5,-.5,-.5,-.5+g,-.5,-.5,-.5,.5,-.5,-.5+g,.5,-.5,.5-g,.5,-.5,.5,-.5,-.5,.5-g,-.5,-.5,.5,-.5,-.5,.5-g,.5,-.5,.5,.5,-.5,-.5+g,.5,-.5,.5-g,.5-e,-.5,-.5+g,.5-e,-.5,.5-g,.5-e,-.5,-.5+g,.5,-.5,.5-g,.5,-.5,-.5+g,-.5+e,-.5,.5-g,-.5,-.5,-.5+g,-.5,-.5,.5-g,-.5,-.5,-.5+g,-.5+e,-.5,.5-g,-.5+e,-.5),n.push(1,0,1-g,1,1,1,1-g,1,1,0,1-g,0,g,0,0,1,g,1,0,1,g,0,0,0,1-g,0,g,e,1-g,e,g,e,1-g,0,g,0,1-g,1-e,g,1,1-g,1,g,1,1-g,1-e,g,1-e)),t===!0?(B.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),n.push(0,0,0,1,1,1,1,1,1,0,0,0)):t===!1||(B.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+f,-.5,-.5,-.5+f,-.5,.5,-.5+f,-.5,.5,-.5,-.5,.5,.5-f,-.5,-.5,.5-f,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-f,-.5,.5,-.5+f,-.5,.5-e,-.5+f,-.5,.5-e,.5-f,-.5,.5-e,.5-f,-.5,.5,.5-f,-.5,.5,-.5+f,-.5,-.5+e,-.5+f,-.5,-.5,-.5+f,-.5,-.5,.5-f,-.5,-.5,.5-f,-.5,-.5+e,.5-f,-.5,-.5+e,-.5+f),n.push(0,0,0,1,f,1,f,1,f,0,0,0,1-f,0,1-f,1,1,1,1,1,1,0,1-f,0,f,0,f,e,1-f,e,1-f,e,1-f,0,f,0,f,1-e,f,1,1-f,1,1-f,1,1-f,1-e,f,1-e)),p===!0?(B.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),n.push(1,0,0,1,1,1,0,1,1,0,0,0)):p===!1||(B.push(.5,.5,-.5,.5,-.5,-.5+f,.5,-.5,-.5,.5,-.5,-.5+f,.5,.5,-.5,.5,.5,-.5+f,.5,.5,.5-f,.5,-.5,.5,.5,-.5,.5-f,.5,-.5,.5,.5,.5,.5-f,.5,.5,.5,.5,.5,-.5+f,.5,.5-e,.5-f,.5,.5-e,-.5+f,.5,.5-e,.5-f,.5,.5,-.5+f,.5,.5,.5-f,.5,-.5+e,-.5+f,.5,-.5,.5-f,.5,-.5,-.5+f,.5,-.5,.5-f,.5,-.5+e,-.5+f,.5,-.5+e,.5-f),n.push(1,0,1-f,1,1,1,1-f,1,1,0,1-f,0,f,0,0,1,f,1,0,1,f,0,0,0,1-f,0,f,e,1-f,e,f,e,1-f,0,f,0,1-f,1-e,f,1,1-f,1,f,1,1-f,1-e,f,1-e)),c===!0?(B.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),n.push(1,1,1,0,0,0,0,0,0,1,1,1)):c===!1||(B.push(.5,.5,.5,.5,.5,-.5,.5-g,.5,-.5,.5-g,.5,-.5,.5-g,.5,.5,.5,.5,.5,-.5+g,.5,.5,-.5+g,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+g,.5,.5,.5-g,.5,.5,.5-g,.5,.5-f,-.5+g,.5,.5-f,-.5+g,.5,.5-f,-.5+g,.5,.5,.5-g,.5,.5,.5-g,.5,-.5+f,.5-g,.5,-.5,-.5+g,.5,-.5,-.5+g,.5,-.5,-.5+g,.5,-.5+f,.5-g,.5,-.5+f),n.push(1,1,1,0,1-g,0,1-g,0,1-g,1,1,1,g,1,g,0,0,0,0,0,0,1,g,1,1-g,1,1-g,1-f,g,1-f,g,1-f,g,1,1-g,1,1-g,f,1-g,0,g,0,g,0,g,f,1-g,f)),G===!0?(B.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),n.push(1,0,0,1,1,1,0,1,1,0,0,0)):G===!1||(B.push(.5,-.5,.5,.5-g,-.5,-.5,.5,-.5,-.5,.5-g,-.5,-.5,.5,-.5,.5,.5-g,-.5,.5,-.5+g,-.5,.5,-.5,-.5,-.5,-.5+g,-.5,-.5,-.5,-.5,-.5,-.5+g,-.5,.5,-.5,-.5,.5,.5-g,-.5,.5,-.5+g,-.5,.5-f,.5-g,-.5,.5-f,-.5+g,-.5,.5-f,.5-g,-.5,.5,-.5+g,-.5,.5,.5-g,-.5,-.5+f,-.5+g,-.5,-.5,.5-g,-.5,-.5,-.5+g,-.5,-.5,.5-g,-.5,-.5+f,-.5+g,-.5,-.5+f),n.push(1,0,1-g,1,1,1,1-g,1,1,0,1-g,0,g,0,0,1,g,1,0,1,g,0,0,0,1-g,0,g,f,1-g,f,g,f,1-g,0,g,0,1-g,1-f,g,1,1-g,1,g,1,1-g,1-f,g,1-f)),{vs:B,uv:n}}}),w(M.Style,{"csg.cull.color":I,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":I,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":R/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),Fc.forEach(function(L){var m={};m[L+e]=!1,m[L+".toggleable"]=!1,m[L+".axis"]=o,m[L+".start"]=0,m[L+".end"]=R/2,m[L+hr]=0,w(M.Style,m,!0)});var xf=function(){this.$4n=[]};xf.$15n=function(e){var L=new xf;return L.$4n=e,L},xf.prototype={clone:function(){var J=new xf;return J.$4n=this.$4n.map(function(B){return B.clone()}),J},$19n:function(){return this.$4n},union:function(Y){var w=new lf(this.clone().$4n),g=new lf(Y.clone().$4n);return w.$3n(g),g.$3n(w),g.$6n(),g.$3n(w),g.$6n(),w.$7n(g.$2n()),xf.$15n(w.$2n())},subtract:function(k){var u=new lf(this.clone().$4n),P=new lf(k.clone().$4n);return u.$6n(),u.$3n(P),P.$3n(u),P.$6n(),P.$3n(u),P.$6n(),u.$7n(P.$2n()),u.$6n(),xf.$15n(u.$2n())},intersect:function(U){var y=new lf(this.clone().$4n),v=new lf(U.clone().$4n);return y.$6n(),v.$3n(y),v.$6n(),y.$3n(v),v.$3n(y),y.$7n(v.$2n()),y.$6n(),xf.$15n(y.$2n())},inverse:function(){var W=this.clone();return W.$4n.map(function(u){u.flip()}),W}},xf.cube=function(q){q=q||{};var Y=new ol(q.center||[0,0,0]),z=q.radius?q.radius.length?q.radius:[q.radius,q.radius,q.radius]:[1,1,1];return xf.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(y){return new dk(y[0].map(function(w){var q=new ol(Y.x+z[0]*(2*!!(1&w)-1),Y.y+z[1]*(2*!!(2&w)-1),Y.z+z[2]*(2*!!(4&w)-1));return new rn(q,new ol(y[1]))}))}))},xf.sphere=function(Z){function G(B,Z){B*=2*R,Z*=R;var c=new ol(K(B)*n(Z),K(Z),n(B)*n(Z));_.push(new rn(p.$20n(c.$21n(S)),c))}Z=Z||{};for(var _,p=new ol(Z.center||[0,0,0]),S=Z.radius||1,W=Z.slices||16,A=Z.stacks||8,i=[],X=0;W>X;X++)for(var o=0;A>o;o++)_=[],G(X/W,o/A),o>0&&G((X+1)/W,o/A),A-1>o&&G((X+1)/W,(o+1)/A),G(X/W,(o+1)/A),i.push(new dk(_));return xf.$15n(i)},xf.cylinder=function(i){function G(b,d,P){var f=2*d*R,I=A.$21n(K(f)).$20n(z.$21n(n(f))),M=T.$20n(x.$21n(b)).$20n(I.$21n(F)),E=I.$21n(1-J(P)).$20n(m.$21n(P));return new rn(M,E)}i=i||{};for(var T=new ol(i.start||[0,-1,0]),X=new ol(i.end||[0,1,0]),x=X.$13n(T),F=i.radius||1,P=i.slices||16,m=x.$14n(),e=J(m.y)>.5,A=new ol(e,!e,0).cross(m).$14n(),z=A.cross(m).$14n(),k=new rn(T,m.$11n()),c=new rn(X,m.$14n()),a=[],V=0;P>V;V++){var H=V/P,Y=(V+1)/P;a.push(new dk([k,G(0,H,-1),G(0,Y,-1)])),a.push(new dk([G(0,Y,0),G(0,H,0),G(1,H,0),G(1,Y,0)])),a.push(new dk([c,G(1,Y,1),G(1,H,1)]))}return xf.$15n(a)};var ol=function(N,x,u){var A=this;3==arguments.length?(A.x=N,A.y=x,A.z=u):"x"in N?(A.x=N.x,A.y=N.y,A.z=N.z):(A.x=N[0],A.y=N[1],A.z=N[2])};ol.prototype={clone:function(){return new ol(this.x,this.y,this.z)},$11n:function(){return new ol(-this.x,-this.y,-this.z)},$20n:function(m){return new ol(this.x+m.x,this.y+m.y,this.z+m.z)},$13n:function(D){return new ol(this.x-D.x,this.y-D.y,this.z-D.z)},$21n:function(z){return new ol(this.x*z,this.y*z,this.z*z)},$16n:function(p){return new ol(this.x/p,this.y/p,this.z/p)},dot:function(E){return this.x*E.x+this.y*E.y+this.z*E.z},lerp:function(I,t){return this.$20n(I.$13n(this).$21n(t))},length:function(){return t(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(w){var X=this;return new ol(X.y*w.z-X.z*w.y,X.z*w.x-X.x*w.z,X.x*w.y-X.y*w.x)}};var rn=function(c,A,f){var W=this;W.$24n=new ol(c),W.$22n=A?new ol(A):null,W.uv=f?new ol(f):null};rn.prototype={clone:function(){var J=this;return new rn(J.$24n.clone(),J.$22n.clone(),J.uv?J.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(F,U){var L=this;return new rn(L.$24n.lerp(F.$24n,U),L.$22n.lerp(F.$22n,U),L.uv?L.uv.lerp(F.uv,U):null)}};var gd=function(i,o){this.$22n=i,this.w=o};gd.$17n=function(k,p,G){var j=p.$13n(k).cross(G.$13n(k)).$14n();return new gd(j,j.dot(k))},gd.prototype={clone:function(){return new gd(this.$22n.clone(),this.w)},flip:function(){var g=this;g.$22n=g.$22n.$11n(),g.w=-g.w},$5n:function(s,O,a,w,$){for(var m=this,q=0,z=1,r=2,H=3,t=0,T=[],U=0;U<s.$9n.length;U++){var o=m.$22n.dot(s.$9n[U].$24n)-m.w,c=-L>o?r:o>L?z:q;t|=c,T.push(c)}switch(t){case q:(m.$22n.dot(s.$8n.$22n)>0?O:a).push(s);break;case z:w.push(s);break;case r:$.push(s);break;case H:for(var I=[],K=[],U=0;U<s.$9n.length;U++){var e=(U+1)%s.$9n.length,u=T[U],V=T[e],d=s.$9n[U],P=s.$9n[e];if(u!=r&&I.push(d),u!=z&&K.push(u!=r?d.clone():d),(u|V)==H){var o=(m.w-this.$22n.dot(d.$24n))/m.$22n.dot(P.$24n.$13n(d.$24n)),k=d.$18n(P,o);I.push(k),K.push(k.clone())}}I.length>=3&&w.push(new dk(I,s.$10n)),K.length>=3&&$.push(new dk(K,s.$10n))}}};var dk=function(S,m){var g=this;g.$9n=S,g.$10n=m,g.$8n=gd.$17n(S[0].$24n,S[1].$24n,S[2].$24n)};dk.prototype={clone:function(){var s=this.$9n.map(function(q){return q.clone()});return new dk(s,this.$10n)},flip:function(){this.$9n.reverse().map(function(X){X.flip()}),this.$8n.flip()}};var lf=function(Z){var L=this;L.$8n=null,L.front=null,L.back=null,L.$4n=[],Z&&L.$7n(Z)};lf.prototype={clone:function(){var t=this,f=new lf;return f.$8n=t.$8n&&t.$8n.clone(),f.front=t.front&&t.front.clone(),f.back=t.back&&t.back.clone(),f.$4n=t.$4n.map(function(b){return b.clone()}),f},$6n:function(){for(var h=this,i=0;i<h.$4n.length;i++)h.$4n[i].flip();h.$8n&&h.$8n.flip(),h.front&&h.front.$6n(),h.back&&h.back.$6n();var T=h.front;h.front=h.back,h.back=T},$1n:function(r){var G=this;if(!G.$8n)return r.slice();for(var V=[],a=[],x=0;x<r.length;x++)G.$8n.$5n(r[x],V,a,V,a);return G.front&&(V=G.front.$1n(V)),a=G.back?G.back.$1n(a):[],V.concat(a)},$3n:function(S){var g=this;g.$4n=S.$1n(g.$4n),g.front&&g.front.$3n(S),g.back&&g.back.$3n(S)},$2n:function(){var $=this,f=$.$4n.slice();return $.front&&(f=f.concat($.front.$2n())),$.back&&(f=f.concat($.back.$2n())),f},$7n:function(c){var T=this;if(c.length){T.$8n||(T.$8n=c[0].$8n.clone());for(var l=[],j=[],d=0;d<c.length;d++)this.$8n.$5n(c[d],T.$4n,T.$4n,l,j);l.length&&(T.front||(T.front=new lf),this.front.$7n(l)),j.length&&(T.back||(T.back=new lf),T.back.$7n(j))}}};var Dm="symbol",wm=M.Symbol=function(I,X,j){var c=this;q(wm,c),c.s3(20,20,20),c.s({"all.visible":!1,shape:"rect"}),c.setIcon(I,X,j)};dj("Symbol",u,{setIcon:function(Q,p,J){var l,R=this;return wm.superClass.setIcon.call(R,Q),Q?(l={for3d:!0,face:"center",position:44,names:[Q]},J&&(l.transaprent=!0),p&&(l.autorotate=p),R.addStyleIcon(Dm,l)):R.removeStyleIcon(Dm),R.setWidth(F.getImageWidth(Z.getImage(Q),R)||20),l}});var rb=M.CSGNode=function(){q(rb,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},Up={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};dj("CSGNode",u,{_22Q:function(){return Oh},onPropertyChanged:function(I){var S=this,P=S.getHost();rb.superClass.onPropertyChanged.call(S,I),Up[I.property]&&(P instanceof wd||P instanceof rb)&&P.fp("csgNodeChange",!0,!1)}});var Oh=function(e,l){q(Oh,this,[e,l])};l(Oh,D.Node3dUI,{_80o:function(Q,q,w){var i=this;i._shape3d?Oh.superClass._80o.call(i,Q,q,w):(E(i.gv),sq.forEach(function(x){U(i,Q,q,x,w)}))},validate:function(V,B){var g=this,_=g.gv,t=g.data;if(t.s("shape3d"))return Oh.superClass.validate.call(g,V,B),g._shape3d=!0,void 0;g._shape3d=!1;var J=s(t,_.getMat(t));t.appendAnchorMatrix3d(J);var D=V&&V.uv;g.vf2("csg",D);for(var O=0;6>O;O++)for(var p=Fc[O],$=Vg[O],U=g.vf2(p,D,B),S=U.mat||J,Y=U.vs,E=U.uv,X=U.tuv,m=0;2>m;m++){var C=x[$+3*m],W=x[$+3*m+1],h=x[$+3*m+2];if(k(Y,S,[A[3*C],A[3*C+1],A[3*C+2]]),k(Y,S,[A[3*W],A[3*W+1],A[3*W+2]]),k(Y,S,[A[3*h],A[3*h+1],A[3*h+2]]),X)if(E){var i=8*O;X.push(E[2*C-i],E[2*C+1-i],E[2*W-i],E[2*W+1-i],E[2*h-i],E[2*h+1-i])}else X.push(f[2*C],f[2*C+1],f[2*W],f[2*W+1],f[2*h],f[2*h+1])}Wo(g,V,B)},vf2:function(q,c,J){var R,i=this,F=i.gv.getFaceVisible(i.data,q);return R=O(i,q,J),R.vs=[],R.tuv=F&&(R.texture||c)?[]:v,R.visible=F,R}});var wd=M.CSGShape=function(){var n=this;q(wd,n),n.s({"shape.background":v,"2d.hostable":!0,"shape.border.width":8}),n.setTall(240),n.setElevation(120),n.setThickness(14)};dj("CSGShape",i,{IRotatable:!1,_22Q:function(){return As},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var As=function(U,b){q(As,this,[U,b])};l(As,D.Shape3dUI,{_80o:function(s,F,h){var O=this;O.undrawable||(E(O.gv),sq.forEach(function(o){U(O,s,F,o,h)}))},validate:function(n,e){var Z=this,O=Z.data,f=O.getPoints();if(Z.undrawable=f.size()<2)return Z.clear(),void 0;var D=O.isClosePath(),I=X(O._thickness/2,L),y=N(f,v,v,D);sq.forEach(function(b){Z.vf(b,n&&n.uv,!0,e)}),D&&(Z.left.visible=!1,Z.right.visible=!1),Z._12O(y,I),Z._20Q(y);var l=O.getPointsMatrix3d(),_=M.Math.requestVector3();Fc.forEach(function(X){if(Z[X])for(var s=Z[X].vs,H=0,W=s.length;W>H;H+=3)_.set(s[H],s[H+1],s[H+2]).applyMatrix4(l),s[H]=_.x,s[H+1]=_.y,s[H+2]=_.z}),M.Math.releaseVector3(_),Wo(Z,n,e)}});var ed=M.DoorWindow=function(){var P=this;q(ed,P),P.setElevation(100),P.s3(100,200,14)};dj("DoorWindow",rb,{IDoorWindow:!0,toggle:function(u){this.setExpanded(!this.s(g),u)},isExpanded:function(){return this.s(g)},setExpanded:function(d,w){var V=this,Q=V.$25n,E=V.s(g);if(Q&&(Q.stop(!0),delete V.$25n),E!==d){V.beginTransaction();var _=d?V.s("dw.end"):V.s("dw.start");V.s(g,d),w=c(w),w?(E=V.s(Dd),w.action=function(L){V.s(Dd,E+(_-E)*L)},w.finishFunc=function(){V.endTransaction()},V.$25n=z(w)):(V.s(Dd,_),V.endTransaction())}},getMat:function(){var q=this,i=q.s("dw.s3"),y=q.s("dw.t3"),c=q.s("dw.flip"),x=q.s(Dd);if(i||x||y||c){var T=[];if(c&&T.push({r3:[0,R,0]}),i&&T.push({s3:i}),x){i=q.getFinalScale3d();var N=q.s("dw.axis"),f=i[0]/2,e=i[1]/2;i[2]/2,N===o?T.push({t3:[f,0,0]},{r3:[0,-x,0]},{t3:[-f,0,0]}):N===h?T.push({t3:[-f,0,0]},{r3:[0,x,0]},{t3:[f,0,0]}):N===m?T.push({t3:[0,-e,0]},{r3:[-x,0,0]},{t3:[0,e,0]}):N===Y?T.push({t3:[0,e,0]},{r3:[x,0,0]},{t3:[0,-e,0]}):N===d?T.push({r3:[0,x,0]}):N===a&&T.push({r3:[x,0,0]})}return y&&T.push({t3:y}),r(T)}return v}});var Ji=M.CSGBox=function(){var H=this;q(Ji,H),H.setElevation(100),H.s3(100,200,100)};dj("CSGBox",rb,{ICSGBox:!0,toggleFace:function(H,B){this.setFaceExpanded(H,!this.s(H+e),B)},isFaceExpanded:function(Z){return this.s(Z+e)},setFaceExpanded:function(Q,v,M){var D=this,y=D.$25n,h=D.s(Q+e);if(y&&(y.stop(!0),delete D.$25n),h!==v){var m=v?D.s(Q+".end"):D.s(Q+".start");D.s(Q+e,v),M=c(M),M?(h=D.s(Q+hr),M.action=function(u){D.s(Q+hr,h+(m-h)*u)},D.$25n=z(M)):D.s(Q+hr,m)}},getFaceMat:function(g){var h=this,I=h.s(g+hr);if(!I)return v;var k,l,V,i,f,X,z=h.s(g+".axis"),x=h.getFinalScale3d(),S=h.getAnchor3d(),G=x[0]*S.x,P=x[1]*S.y,N=x[2]*S.z,L=x[0]-G,p=x[1]-P,M=x[2]-N,T=g+"_"+z;switch(T){case"front_left":k=-G,l=0,V=M,i=0,f=-I,X=0;break;case"front_right":k=L,l=0,V=M,i=0,f=I,X=0;break;case"front_top":k=0,l=p,V=M,i=-I,f=0,X=0;break;case"front_bottom":k=0,l=-P,V=M,i=I,f=0,X=0;break;case"front_h":k=0,l=0,V=M,i=I,f=0,X=0;break;case"front_v":k=0,l=0,V=M,i=0,f=I,X=0;break;case"back_left":k=L,l=0,V=-N,i=0,f=-I,X=0;break;case"back_right":k=-G,l=0,V=-N,i=0,f=I,X=0;break;case"back_top":k=0,l=p,V=-N,i=I,f=0,X=0;break;case"back_bottom":k=0,l=-P,V=-N,i=-I,f=0,X=0;break;case"back_h":k=0,l=0,V=-N,i=I,f=0,X=0;break;case"back_v":k=0,l=0,V=-N,i=0,f=I,X=0;break;case"left_left":k=-G,l=0,V=-N,i=0,f=-I,X=0;break;case"left_right":k=-G,l=0,V=M,i=0,f=I,X=0;break;case"left_top":k=-G,l=p,V=0,i=0,f=0,X=-I;break;case"left_bottom":k=-G,l=-P,V=0,i=0,f=0,X=I;break;case"left_h":k=-G,l=0,V=0,i=0,f=0,X=I;break;case"left_v":k=-G,l=0,V=0,i=0,f=I,X=0;break;case"right_left":k=L,l=0,V=M,i=0,f=-I,X=0;break;case"right_right":k=L,l=0,V=-N,i=0,f=I,X=0;break;case"right_top":k=L,l=p,V=0,i=0,f=0,X=I;break;case"right_bottom":k=L,l=-P,V=0,i=0,f=0,X=-I;break;case"right_h":k=L,l=0,V=0,i=0,f=0,X=I;break;case"right_v":k=L,l=0,V=0,i=0,f=I,X=0;break;case"top_left":k=-G,l=p,V=0,i=0,f=0,X=I;break;case"top_right":k=L,l=p,V=0,i=0,f=0,X=-I;break;case"top_top":k=0,l=p,V=-N,i=-I,f=0,X=0;break;case"top_bottom":k=0,l=p,V=M,i=I,f=0,X=0;break;case"top_h":k=0,l=p,V=0,i=I,f=0,X=0;break;case"top_v":k=0,l=p,V=0,i=0,f=0,X=I;break;case"bottom_left":k=-G,l=-P,V=0,i=0,f=0,X=-I;break;case"bottom_right":k=L,l=-P,V=0,i=0,f=0,X=I;break;case"bottom_top":k=0,l=-P,V=M,i=-I,f=0,X=0;break;case"bottom_bottom":k=0,l=-P,V=-N,i=I,f=0,X=0;break;case"bottom_h":k=0,l=-P,V=0,i=I,f=0,X=0;break;case"bottom_v":k=0,l=-P,V=0,i=0,f=0,X=I}return r([{t3:[-k,-l,-V]},{r3:[i,f,X]},{t3:[k,l,V]}])}});var Pn=function(f,J,W,t,M){function Y(){var V,m=[],o=new j,O=new j;for(n.eachShapeModel(function(x,X,C){for(var L=0,t=X?X.length:x.length/3;t>L;L++)X?(o.fromArray(x,3*X[L]),O.fromArray(C,3*X[L])):(o.fromArray(x,3*L),O.fromArray(C,3*L)),e(m,o,O)}),m=A(m,C.set(1,0,0)),m=A(m,C.set(-1,0,0)),m=A(m,C.set(0,1,0)),m=A(m,C.set(0,-1,0)),m=A(m,C.set(0,0,1)),m=A(m,C.set(0,0,-1)),V=0;V<m.length;V++){var G=m[V];x.push(.5+G.position.x/M.x,.5-G.position.y/M.y),G.position.applyMatrix4(v),X.push(G.position.x,G.position.y,G.position.z),L.push(G.$22n.x,G.$22n.y,G.$22n.z)}}function e(C,F,V){F.applyMatrix4(q),F.applyMatrix4(Z),V.transformDirection(q),V.transformDirection(Z),C.push(new $(F.clone(),V.clone()))}function A(b,q){for(var L=[],F=.5*Math.abs(M.dot(q)),i=0;i<b.length;i+=3){var d,f,O,$,v,W,G,J=0,c=b[i+0].position.dot(q)-F,w=b[i+1].position.dot(q)-F,o=b[i+2].position.dot(q)-F;switch(d=c>0,f=w>0,O=o>0,J=(d?1:0)+(f?1:0)+(O?1:0)){case 0:L.push(b[i]),L.push(b[i+1]),L.push(b[i+2]);break;case 1:if(d&&($=b[i+1],v=b[i+2],W=S(b[i],$,q,F),G=S(b[i],v,q,F)),f){$=b[i],v=b[i+2],W=S(b[i+1],$,q,F),G=S(b[i+1],v,q,F),L.push(W),L.push(v.clone()),L.push($.clone()),L.push(v.clone()),L.push(W.clone()),L.push(G);break}O&&($=b[i],v=b[i+1],W=S(b[i+2],$,q,F),G=S(b[i+2],v,q,F)),L.push($.clone()),L.push(v.clone()),L.push(W),L.push(G),L.push(W.clone()),L.push(v.clone());break;case 2:d||($=b[i].clone(),v=S($,b[i+1],q,F),W=S($,b[i+2],q,F),L.push($),L.push(v),L.push(W)),f||($=b[i+1].clone(),v=S($,b[i+2],q,F),W=S($,b[i],q,F),L.push($),L.push(v),L.push(W)),O||($=b[i+2].clone(),v=S($,b[i],q,F),W=S($,b[i+1],q,F),L.push($),L.push(v),L.push(W));break;case 3:}}return L}function S(r,N,y,J){var I=r.position.dot(y)-J,X=N.position.dot(y)-J,m=I/(I-X),z=new $(new j(r.position.x+m*(N.position.x-r.position.x),r.position.y+m*(N.position.y-r.position.y),r.position.z+m*(N.position.z-r.position.z)),new j(r.$22n.x+m*(N.$22n.x-r.$22n.x),r.$22n.y+m*(N.$22n.y-r.$22n.y),r.$22n.z+m*(N.$22n.z-r.$22n.z)));return z}var X=[],L=[],x=[],C=new j,n=f.getData3dUI(J);if(n.mat){var q=(new T).fromArray(n.mat),G=new T;G.makeRotationFromEuler(t),G.setPosition(W);var Z=(new T).getInverse(G),v=(new T).scale({x:1/M.x,y:1/M.y,z:1/M.z});return Y(),{vs:X,ns:L,uv:x}}};$.prototype.clone=function(){return new $(this.position.clone(),this.$22n.clone())};var Aj=function(J,P,h,Z){var g=this,o=g.getDataAt(J);if(o){var W=g.intersectObject(J,o);if(W){"object"==typeof P?P=P.x?new j(P.x,P.y,P.z):new j(P[0],P[1],P[2]):(P=P||20,P=new j(P,P,P)),h=h===I?.1:h;var x=new j(g.getUp()),O=new j(g.getCenter()).sub(new j(g.getEye())).normalize(),Y="cross",H=O.clone()[Y](x).normalize();x.copy(H)[Y](O).normalize(),Z&&x.applyAxisAngle(W.worldNormal,-Z);var C=new M.Node,U=W.worldNormal.clone().setLength(h).add(W.world),N=(new T).lookAt(W.worldNormal.clone(),new j(0,0,0),x),q=(new B).setFromRotationMatrix(N),r=Pn(g,o,W.world.clone(),q,P);return C.p3(U.x,U.y,U.z),C.setEuler(q),C.s3(P.x,P.y,P.z),C.s({shape3d:r,"shape3d.reverse.flip":!0}),C}}};w(M.graph3d.Graph3dView,{createDecal:Aj})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);